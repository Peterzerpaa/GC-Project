<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>GC-Project - Calculadora Energ√©tica</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        #playing-indicator {
            display: none;
            font-weight: bold;
            color: #1a73e8;
            margin-top: 10px;
        }

        #repeat-btn {
            margin-top: 10px;
            padding: 6px 12px;
            background-color: #1a73e8;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #repeat-btn:hover {
            background-color: #155ab6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Calculadora de Consumo Energ√©tico</h1>

        <!-- Formulario manual -->
        <form action="/calculate" method="POST">
            <h2>Introduce tu dispositivo</h2>
            <label for="device_name">Nombre del dispositivo:</label>
            <input type="text" name="device_name" required>

            <label for="usage_hours">Horas de uso al d√≠a:</label>
            <input type="number" name="usage_hours" step="0.1" required>

            <button type="submit">Calcular consumo</button>
        </form>

        <!-- Formulario de reconocimiento -->
        <form action="/recognize" method="POST" enctype="multipart/form-data">
            <h2>O sube una imagen del dispositivo</h2>
            <input type="file" name="device_image" accept="image/*" required>
            <button type="submit">Reconocer y calcular</button>
        </form>

        {% if result %}
        <div class="result-box">
            <h2>Resultados</h2>
            <p><strong>Dispositivo:</strong> {{ result.device }}</p>
            <p><strong>Horas de uso:</strong> {{ result.hours }} h/d√≠a</p>
            <p><strong>Potencia:</strong> {{ result.watts }} W</p>
            <p><strong>Consumo diario:</strong> {{ result.kwh }} kWh</p>
            <p><strong>Nivel de consumo:</strong> {{ result.level }}</p>
            <p><strong>Consejos:</strong></p>
            <ul>
                {% for tip in result.advice %}
                <li>{{ tip }}</li>
                {% endfor %}
            </ul>
            {% if result.predictions %}
            <p><strong>Predicciones del modelo:</strong></p>
            <ul>
                {% for _, label, prob in result.predictions %}
                <li>{{ label }} - {{ '%.2f' | format(prob * 100) }}%</li>
                {% endfor %}
            </ul>
            {% endif %}

            <!-- Indicador y bot√≥n de audio -->
            <p id="playing-indicator">üîä Reproduciendo audio...</p>
            <button id="repeat-btn" onclick="reproducirAudio()">üîÅ Repetir audio</button>
            <audio id="audio" src="{{ url_for('static', filename='audio.mp3') }}"></audio>
        </div>
        {% endif %}
    </div>

    <script>
        const audio = document.getElementById("audio");
        const indicator = document.getElementById("playing-indicator");

        function reproducirAudio() {
            if (audio) {
                indicator.style.display = "block";
                audio.play();
            }
        }

        if (audio) {
            audio.addEventListener("ended", () => {
                indicator.style.display = "none";
            });

            // Reproduce autom√°ticamente al cargar la p√°gina con resultados
            window.onload = function () {
                reproducirAudio();
            };
        }
    </script>
</body>
</html>
